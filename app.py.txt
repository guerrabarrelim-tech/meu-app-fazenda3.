import streamlit as st
import folium
from streamlit_folium import st_folium
from folium.plugins import Draw
import pandas as pd

# Configura칞칚o da p치gina
st.set_page_config(page_title="Gestor de Safra Pro", layout="wide")

st.title("游뚶 Sistema de Gest칚o de 츼reas e Safra")

# Criando abas para organizar o app
tab1, tab2 = st.tabs(["游늸 Mapear 츼rea", "游닇 Di치rio de Campo"])

with tab1:
    st.header("Desenhe o Talh칚o no Mapa")
    st.write("Use as ferramentas  esquerda do mapa para desenhar o pol칤gono da sua 치rea.")
    
    # Centraliza칞칚o inicial (pode ser alterada para as coordenadas da sua fazenda)
    m = folium.Map(location=[-18.48, -49.12], zoom_start=13, tiles="CartoDB satellite")
    
    # Adiciona ferramentas de desenho
    draw = Draw(
        export=True,
        filename='area_fazenda.geojson',
        position='topleft',
        draw_options={
            'polyline': False,
            'rectangle': True,
            'circle': False,
            'marker': False,
            'circlemarker': False,
            'polygon': True,
        }
    )
    draw.add_to(m)
    
    # Renderiza o mapa e captura os dados do desenho
    output = st_folium(m, width=900, height=500)
    
    # Se o usu치rio desenhou algo, extra칤mos as coordenadas
    if output['all_drawings']:
        st.success("츼rea selecionada com sucesso!")
        coords = output['all_drawings'][0]['geometry']['coordinates']
        st.write(f"Coordenadas capturadas: {coords}")

with tab2:
    st.header("Dados da Cultura e Aplica칞칚o")
    
    with st.form("diario_safra"):
        col1, col2 = st.columns(2)
        
        with col1:
            cultura = st.text_input("Cultura (Ex: Soja, Milho)")
            data_plantio = st.date_input("Data do Plantio")
            safra = st.text_input("Ano da Safra (Ex: 24/25)")
            adubo = st.text_input("Aduba칞칚o Utilizada")
            
        with col2:
            metodo = st.selectbox("M칠todo de Aplica칞칚o", ["Uniport", "Piv칪 Central", "A Lan칞o"])
            produto = st.text_input("Produto Qu칤mico/Defensivo")
            dose = st.number_input("Quantidade por hectare (kg ou L/ha)", min_value=0.0)
            data_app = st.date_input("Data da Aplica칞칚o")

        # Bot칚o para salvar
        submitted = st.form_submit_button("Salvar Registro")
        if submitted:
            st.info(f"Registro de {cultura} (Safra {safra}) armazenado no hist칩rico.")